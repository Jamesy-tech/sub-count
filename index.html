<!DOCTYPE html>
<html>
<head>
    <title>Sub Count Notifier</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1 id="subs">Loading...</h1>
    <p id="countdown"></p>
    <p id="debug"></p>

    <script>
        const apiKey = "AIzaSyAHwcEU_hm_L7zJ65S16GqBX_vJ2_sS02I";
        const channelId = "UCBeRITLbzQs2WLP1U7vJ3SQ";
        const CHECK_INTERVAL = 120;
        let timeLeft = CHECK_INTERVAL;
        let lastSubCount = null;

        async function loadSubs() {
            try {
                const url = `https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=${apiKey}`;
                const res = await fetch(url);
                if (!res.ok) throw new Error("HTTP error " + res.status);
                const data = await res.json();
                const subs = data.items[0].statistics.subscriberCount;
                document.getElementById("subs").textContent = "Subscribers: " + subs;

                if (Notification.permission === "granted") {
                    new Notification("Sub Count Update", { body: `You now have ${subs} subscribers.` });
                    document.getElementById("debug").textContent = "Notification sent successfully";
                } else {
                    document.getElementById("debug").textContent = "Notification blocked or permission not granted";
                }

                lastSubCount = subs;
            } catch (err) {
                document.getElementById("debug").textContent = "Error fetching sub count: " + err;
            }
        }

        function updateCountdown() {
            document.getElementById("countdown").textContent = "Next check in: " + timeLeft + "s";
            timeLeft--;
            if (timeLeft < 0) {
                loadSubs();
                timeLeft = CHECK_INTERVAL;
            }
        }

        if (Notification.permission !== "granted") {
            Notification.requestPermission().then(p => {
                if (p !== "granted") document.getElementById("debug").textContent = "Notifications not allowed";
            });
        }

        loadSubs();
        setInterval(updateCountdown, 1000);
    </script>
</body>
</html>
